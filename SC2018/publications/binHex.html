<!DOCTYPE html>
<style>

    .hexagon {
        stroke: #000;
        stroke-width: 0.5px;
    }
    .tick {
        font-size: 20px;
    }
</style>
<svg width="960" height="2000"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
<script src="//d3js.org/d3-scale-chromatic.v0.3.min.js"></script>

<script>

    var svg = d3.select("svg"),
        margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = +svg.attr("width") - margin.left - margin.right,
        height = +svg.attr("height") - margin.top - margin.bottom,
        g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        g2 = svg.append("g").attr("transform", "translate(" + margin.left + "," + (margin.top +1000)+ ")");

    d3.tsv("dataForCRII/faithful2.tsv", function(d) {
        d.eruptions = +d.eruptions;
        d.waiting = +d.waiting;
        return d;
    }, function(error, faithful) {

        if (error) throw error;

        var x = d3.scaleLinear()
        //.domain([40, 100])
            .domain([1.38, 5.5])
            .range([0, width ]);
        var y = d3.scaleLinear()
            .domain([100, 38])
            .range([0, width]);

        var data = [];
        faithful.forEach(function (d) {
            for (var i=0; i<20;i++){
                var e = [];
                var randomX = d3.randomNormal(0, 16),
                    randomY = d3.randomNormal(0, 20);
                e.push(x(d.eruptions)+randomX());
                e.push(y(d.waiting)+randomY());
                data.push(e);
            }
        })



        var color = d3.scaleSequential(d3["interpolateBlues"])
            .domain([0, 40]);

        var hexbin = d3.hexbin()
            .radius(16)
            .extent([[0, 0], [width, height]]);



        g.append("clipPath")
            .attr("id", "clip")
            .append("rect")
            .attr("width", width)
            .attr("height", height);

        g.append("g")
            .attr("class", "circle")
            .attr("clip-path", "url(#clip)")
            .selectAll("path")
            .data(data)
            .enter().append("circle")
            .attr("cx", function (d) {
                return d[0];
            })
            .attr("cy", function (d) {
                return d[1];
            })
            .attr("r", 4)
            .attr("fill", "#4682b6")
            .attr("fill-opacity", 0.4);



        g2.append("g")
            .attr("class", "hexagon")
            .attr("clip-path", "url(#clip)")
            .selectAll("path")
            .data(hexbin(data))
            .enter().append("path")
            .attr("d", hexbin.hexagon())
            .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
            .attr("fill", function(d) { return color(d.length); });


 //*************************

        g.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y).tickSizeOuter(-width));

        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + width + ")")
            .call(d3.axisBottom(x).tickSizeOuter(-width));

        g2.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y).tickSizeOuter(-width));

        g2.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + width + ")")
            .call(d3.axisBottom(x).tickSizeOuter(-width));
    });

</script>